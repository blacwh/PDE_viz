const DATA_2 = {"graph2_data": [[[100, 0.0004988449509255588], [200, 2.1885167370783165e-05], [300, 2.954826777568087e-05], [400, 0.00010705157183110714], [500, 1.6377782230847515e-05], [600, 0.00015419870032928884], [700, 1.9162735043209977e-05], [800, 0.00019037237507291138], [900, 2.7875548767042346e-05], [1000, 3.123486021650024e-05], [2000, 1.68311034940416e-05], [3000, 1.148272531281691e-05], [4000, 9.801791748031974e-06], [5000, 0.00010536317131482065], [6000, 0.00033281531068496406], [7000, 3.552281850716099e-05], [8000, 3.970190300606191e-05], [9000, 7.699196430621669e-06], [10000, 3.1300633054343052e-06], [20000, 1.1830098628706764e-05]], [[100, 0.00013805042544845492], [200, 4.619700484909117e-05], [300, 8.107248868327588e-05], [400, 0.00013416088768281043], [500, 0.0006703087710775435], [600, 0.0021187630482017994], [700, 0.00034577245241962373], [800, 0.0004090307338628918], [900, 0.0006700511439703405], [1000, 0.00023762136697769165], [2000, 0.002135923597961664], [3000, 0.002635235597961664], [4000, 0.0028347745537757874], [5000, 0.0010041423374786973], [6000, 0.0013278387486934662], [7000, 0.0012678387486934662], [8000, 0.00012325574061833322], [9000, 0.00026875786716118455], [10000, 0.0012810193002223969], [20000, 0.0003235851472709328]], [[100, 0.0013956762850284576], [200, 1.6782170860096812e-05], [300, 1.664770388742909e-05], [400, 7.086167897796258e-05], [500, 2.1416064555523917e-05], [600, 3.0334940674947575e-05], [700, 0.00025065476074814796], [800, 0.0016991449519991875], [900, 0.0007911418215371668], [1000, 2.565276008681394e-05], [2000, 0.0007754621910862625], [3000, 0.0016193323535844684], [4000, 0.035548631101846695], [5000, 0.001043294440023601], [6000, 0.0008776745526120067], [7000, 0.0007218327955342829], [8000, 0.0022909832186996937], [9000, 0.0015294280601665378], [10000, 0.00013011571718379855], [20000, 0.0005924100987613201]], [[100, 2.931981362053193e-05], [200, 3.7635436456184834e-06], [300, 4.735703441838268e-06], [400, 1.544306542200502e-05], [500, 3.466534508334007e-06], [600, 8.708718814887106e-05], [700, 1.1314097719150595e-05], [800, 3.305320205981843e-06], [900, 3.3316148346784757e-06], [1000, 3.5107204894302413e-06], [2000, 6.226707773748785e-05], [3000, 2.7686382964020595e-06], [4000, 9.152458005701192e-06], [5000, 2.5141248443105724e-06], [6000, 0.00018723815446719527], [7000, 3.4321228667977266e-06], [8000, 6.746569852111861e-06], [9000, 3.772453055717051e-06], [10000, 4.0278382584801875e-06], [20000, 2.786356617434649e-06]], [[100, 3.894984911312349e-05], [200, 0.0006401708233170211], [300, 0.0009465125622227788], [400, 1.9720149794011377e-05], [500, 8.67694598127855e-06], [600, 7.891005952842534e-05], [700, 0.00013765288167633116], [800, 1.5126239304663613e-05], [900, 2.8781228138541337e-06], [1000, 9.45966094150208e-05], [2000, 1.0167832442675717e-05], [3000, 4.002411060355371e-06], [4000, 4.926846486341674e-06], [5000, 7.782571628922597e-05], [6000, 7.235165867314208e-06], [7000, 1.667139986238908e-05], [8000, 5.212484666117234e-06], [9000, 2.7194015274289995e-05], [10000, 1.720397631288506e-05], [20000, 1.2483098544180393e-05]], [[100, 0.0014738040044903755], [200, 7.615356298629194e-05], [300, 0.0006053420947864652], [400, 0.0005658082664012909], [500, 0.00022046641970518976], [600, 0.0010653819190338254], [700, 0.001660217996686697], [800, 6.763470446458086e-05], [900, 0.0008189956424757838], [1000, 0.00039276620373129845], [2000, 0.0006636605248786509], [3000, 0.000419073534430936], [4000, 0.0002831264864653349], [5000, 0.038074348121881485], [6000, 0.0002132471272489056], [7000, 3.285239654360339e-05], [8000, 1.3408947779680602e-05], [9000, 4.134528717258945e-05], [10000, 1.1666375030472409e-05], [20000, 4.588924184645293e-06]], [[100, 1.3981093616166618e-05], [200, 1.2986984074814245e-05], [300, 6.766367732780054e-06], [400, 8.770349268161226e-06], [500, 4.590444859786658e-06], [600, 1.4125740563031286e-05], [700, 6.493122327810852e-06], [800, 0.0007410827092826366], [900, 2.3048398361424915e-05], [1000, 7.745159564365167e-06], [2000, 0.0028406702913343906], [3000, 9.90520311461296e-06], [4000, 7.798063052177895e-06], [5000, 7.252472641994245e-06], [6000, 1.1137175533804111e-05], [7000, 5.540236543311039e-06], [8000, 7.928404556878377e-06], [9000, 6.1704272411589045e-06], [10000, 8.958853868534788e-06], [20000, 9.297093492932618e-05]], [[100, 0.0026311087422072887], [200, 0.001198729034513235], [300, 5.80641244596336e-06], [400, 0.00063328753458336], [500, 0.0016495013842359185], [600, 1.5822992281755432e-05], [700, 3.8612641219515353e-05], [800, 7.211777119664475e-05], [900, 4.66534766019322e-05], [1000, 1.941100344993174e-05], [2000, 1.2783646525349468e-05], [3000, 2.129205495293718e-05], [4000, 9.189649972540792e-06], [5000, 1.639976653677877e-05], [6000, 9.064845471584704e-06], [7000, 1.1987567631877027e-05], [8000, 9.905599654302932e-06], [9000, 1.2892987797386013e-05], [10000, 2.825705087161623e-05], [20000, 6.519291491713375e-05]], [[100, 0.0003926224890165031], [200, 8.358415652764961e-05], [300, 0.00014326086966320872], [400, 0.00023441969824489206], [500, 0.0013381148455664515], [600, 8.809420978650451e-05], [700, 0.0001048854028340429], [800, 0.00032611601636745036], [900, 0.00018595842993818223], [1000, 0.00043619360076263547], [2000, 0.00010711330105550587], [3000, 3.179272243869491e-05], [4000, 1.9896560843335465e-05], [5000, 8.84692053659819e-06], [6000, 1.9265433365944773e-05], [7000, 1.7921247490448877e-05], [8000, 0.00019181134121026844], [9000, 6.206916623341385e-06], [10000, 7.615084905410185e-05], [20000, 9.378505637869239e-06]], [[100, 0.0010705300373956561], [200, 4.844903014600277e-05], [300, 2.959320045192726e-05], [400, 0.0003170784329995513], [500, 0.000351008668076247], [600, 0.001423494191840291], [700, 0.0001270415959879756], [800, 8.114426236716099e-06], [900, 3.5011621548619587e-06], [1000, 7.001073299761629e-06], [2000, 8.511926716892049e-05], [3000, 6.233976819203235e-06], [4000, 7.504409040848259e-06], [5000, 4.773972705152119e-06], [6000, 4.441788405529223e-06], [7000, 1.9118097043246962e-05], [8000, 5.306574166752398e-06], [9000, 2.2080104827182367e-05], [10000, 5.814702490170021e-06], [20000, 5.847351985721616e-06]]]};
const DATA_3 = {"graph3_data": [[[100, 0.9166424999999999], [200, 0.680975], [300, 0.9876199999999999], [400, 0.149845], [500, 0.8142], [600, 0.181485], [700, 6.401177499999999], [800, 0.4937825], [900, 0.11590000000000003], [1000, 0.21639749999999996], [2000, 0.10248749999999995], [3000, 0.09716999999999998], [4000, 14.4052725], [5000, 7.897114999999999], [6000, 0.05800250000000001], [7000, 0.0418675], [8000, 0.07050000000000001], [9000, 0.33202999999999994], [10000, 0.008250000000000035], [20000, 0.010969999999999952]], [[100, 0.8702375], [200, 0.937405], [300, 0.8082975], [400, 0.8564499999999999], [500, 0.09609999999999999], [600, 0.1899225], [700, 0.25032], [800, 8.5634825], [900, 0.46138250000000003], [1000, 0.132985], [2000, 0.0959775], [3000, 0.07019749999999997], [4000, 0.07652249999999997], [5000, 0.080845], [6000, 0.04662000000000005], [7000, 0.10869500000000004], [8000, 0.10566000000000003], [9000, 0.0706225], [10000, 0.06122749999999996], [20000, 0.018572500000000047]], [[100, 1.3841124999999999], [200, 0.91005], [300, 0.9419700000000001], [400, 0.6939375000000001], [500, 4.751237499999999], [600, 0.6735375], [700, 0.66124], [800, 0.543225], [900, 0.6318524999999999], [1000, 5.0252574999999995], [2000, 0.17172749999999998], [3000, 0.08034749999999999], [4000, 2.8077825], [5000, 12.0303325], [6000, 10.080555000000002], [7000, 0.45215249999999996], [8000, 0.059542500000000054], [9000, 0.12314750000000002], [10000, 0.07886750000000001], [20000, 0.023682500000000023]],[[100, 0.8668275], [200, 0.9642], [300, 0.6973625000000001], [400, 0.18196999999999997], [500, 0.24100499999999997], [600, 0.18849999999999995], [700, 0.16303749999999997], [800, 0.05742], [900, 0.06018499999999999], [1000, 0.06541999999999998], [2000, 0.07777750000000003], [3000, 0.09439249999999999], [4000, 0.043267500000000014], [5000, 0.14322000000000001], [6000, 0.11335249999999997], [7000, 0.06325749999999994], [8000, 0.263335], [9000, 0.048722499999999946], [10000, 0.04385], [20000, 0.027650000000000063]],[[100, 0.90413], [200, 0.8419449999999999], [300, 0.9619650000000001], [400, 0.8565], [500, 0.8221275], [600, 0.683475], [700, 0.6998825], [800, 0.3457125], [900, 0.48250750000000003], [1000, 0.16803249999999997], [2000, 0.15258000000000002], [3000, 0.18105], [4000, 0.14664499999999997], [5000, 0.09844750000000002], [6000, 0.09235749999999998], [7000, 0.10240250000000001], [8000, 0.1393675], [9000, 0.09472000000000003], [10000, 0.2059875], [20000, 0.02812500000000001]],[[100, 0.8084549999999999], [200, 0.7877500000000001], [300, 0.84817], [400, 0.7281825000000001], [500, 0.27334250000000004], [600, 0.29225499999999993], [700, 0.20282500000000003], [800, 0.08167499999999997], [900, 0.13401000000000002], [1000, 0.08774749999999998], [2000, 0.0927675], [3000, 0.0941575], [4000, 0.08519250000000003], [5000, 0.048065], [6000, 0.076155], [7000, 0.09842999999999996], [8000, 0.12467], [9000, 0.060679999999999984], [10000, 0.08318249999999999], [20000, 0.028822500000000056]],[[100, 0.8785700000000001], [200, 0.807875], [300, 0.7452675], [400, 0.40776249999999997], [500, 0.39488500000000004], [600, 0.21158], [700, 0.40970999999999996], [800, 0.17518250000000005], [900, 0.4685125], [1000, 0.21651499999999996], [2000, 0.13840999999999995], [3000, 0.21034250000000002], [4000, 0.07556749999999998], [5000, 0.29773249999999996], [6000, 0.11250749999999998], [7000, 0.12491749999999999], [8000, 0.02070999999999995], [9000, 0.18846749999999995], [10000, 0.058365], [20000, 0.02901999999999999]],[[100, 0.9039275], [200, 0.6506000000000001], [300, 0.589445], [400, 0.1368325], [500, 0.21239999999999998], [600, 0.17823749999999997], [700, 0.16517000000000004], [800, 0.16242000000000004], [900, 0.10857999999999995], [1000, 0.162285], [2000, 0.15123499999999995], [3000, 0.08142750000000001], [4000, 0.069635], [5000, 0.05902500000000002], [6000, 0.059067499999999995], [7000, 0.0620125], [8000, 0.11736249999999998], [9000, 0.12645999999999996], [10000, 0.05303999999999992], [20000, 0.03334249999999994]],[[100, 1.4997027500000002], [200, 0.12201000000000001], [300, 0.114015], [400, 0.18281], [500, 0.22448500000000002], [600, 0.11059250000000004], [700, 0.06427250000000001], [800, 15.014779999999998], [900, 0.1924225], [1000, 0.17706750000000002], [2000, 0.12319750000000002], [3000, 0.041929999999999995], [4000, 0.06966749999999994], [5000, 0.06625249999999999], [6000, 0.06527249999999998], [7000, 0.06109999999999996], [8000, 0.052800000000000014], [9000, 0.05629249999999997], [10000, 0.02174250000000008], [20000, 0.0336225]],[[100, 1.1715875], [200, 0.7639950000000001], [300, 0.5630275], [400, 0.1615475], [500, 0.24180999999999997], [600, 0.22819749999999997], [700, 0.15780999999999998], [800, 0.06477], [900, 0.10293999999999998], [1000, 0.09794749999999997], [2000, 0.035609999999999975], [3000, 0.08345000000000002], [4000, 0.05885499999999999], [5000, 0.03978000000000001], [6000, 0.05260500000000001], [7000, 0.08574500000000004], [8000, 0.033477499999999966], [9000, 0.04648499999999994], [10000, 0.06403249999999999], [20000, 0.03429499999999994]]]};
graph2_data = DATA_2.graph2_data;
graph3_data = DATA_3.graph3_data;

const results = { 
    1: [0.9969005657770025, 2.001920706147248, 1.0029586212728263, 1.0027885782961732, 0.9998440932407937, 1.0000467533015485],
    2: [0.9973193419175118, 2.0014742591416397, 1.0050079553287417, 1.0023628401096543, 1.0007547051684305, 1.0062920821690458],
    3: [0.9924864146763425, 1.993122079277429, 1.0009508201987023, 1.0012456948679314, 0.9930638191402186, 1.0001582980273562],
    4: [1.0053876601594742, 2.0066174707652586, 0.9958248374796341, 0.9981441540242273, 0.9947996109255752, 0.9955865284952959],
    5: [0.9967852978933144, 1.996506660679261, 0.9930076464598978, 0.9966211422963457, 0.994881918855133, 1.0059276661839518],
    6: [0.9997131666790389, 2.0020839246882645, 0.990953490558544, 0.994120184467762, 1.0087179501041532, 1.0028074669129272],
    7: [0.9973917076920785, 1.9916750103321148, 1.001737021048339, 0.9955093081693045, 1.0045619370931076, 1.0072970680520512],
    8: [0.9952576234986882, 2.0066046851817068, 1.003508651939641, 0.992320902860208, 0.9969447762292662, 0.9922475345331851],
    9: [0.9963477444000894, 2.008083096134174, 1.006169724318491, 1.0077238420455525, 1.0006442311173531, 1.0073493507845188],
    0: [1.006470481379117, 2.0100064449186164, 1.0044481449164213, 1.0063343210247153, 1.0022992248647045, 1.0047363828964255]
    }



let draw_s = function(b_id) {
    var width = 1310,
            height = 300,
            nodeSize = 10;

    let draw_ss = function(data_s) {
        d3.select("#str").select("svg").remove();
        var svg = d3.select("#str").append("svg")
                    .attr("width", width)
                    .attr("height", height);
    d3.json(data_s, function(data_sj){
        var nodes = data_sj.nodes;

        // get network size
        var netsize = {};
        nodes.forEach(function (d) {
            if(d.layer in netsize) {
                netsize[d.layer] += 1;
            } else {
                netsize[d.layer] = 1;
            }
            d["lidx"] = netsize[d.layer];
        });

        // calc distances between nodes
        var largestLayerSize = Math.max.apply(
            null, Object.keys(netsize).map(function (i) { return netsize[i]; }));

        var xdist = width / Object.keys(netsize).length,
            ydist = height / largestLayerSize;

        // create node locations
        nodes.map(function(d) {
            d["x"] = (d.layer - 0.5) * xdist;
            d["y"] = (d.lidx - 0.5) * ydist;
        });

        // autogenerate links
        var links = [];
        nodes.map(function(d, i) {
            for (var n in nodes) {
            if (d.layer + 1 == nodes[n].layer) {
                links.push({"source": parseInt(i), "target": parseInt(n), "value": 1}) }
            }
        }).filter(function(d) { return typeof d !== "undefined"; });

        // draw links
        var link = svg.selectAll(".link")
            .data(links)
            .enter().append("line")
            .attr("class", "link")
            .attr("x1", function(d) { return nodes[d.source].x; })
            .attr("y1", function(d) { return nodes[d.source].y; })
            .attr("x2", function(d) { return nodes[d.target].x; })
            .attr("y2", function(d) { return nodes[d.target].y; })
            .style("stroke-width", function(d) { return Math.sqrt(d.value); });

        // draw nodes
        var node = svg.selectAll(".node")
            .data(nodes)
            .enter().append("g")
            .attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")"; }
            );

        var circle = node.append("circle")
            .attr("class", "node")
            .attr("r", nodeSize)
            .style("fill", '#323392')
            // function(d) { return color(d.layer); });
            });

    }

    // let color = d3.scaleOrdinal(d3.schemeCategory10);
    const head = "static/data/"
    // let nn = document.getElementById('nn').innerHTML.slice(-1);
    let nn = b_id.slice(-1);
    let data_s = head + "data" + nn + ".json";
    draw_ss(data_s);
};

let draw_l = function(b_id) {
    let rank = parseInt(b_id.slice(-1));
    let myChart_l = echarts.init(document.getElementById("line"));
    let option;

    option = {
        xAxis: {
            type: "log",

        },
        yAxis: {
            type: "log"
        },
        // toolbox: {
        //     feature: {
        //         saveAsImage: {}
        //     }
        // },
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                label: {
                    fontStyle: 'italic',
                    precision: 0
                }
        }
        },
        legend: {
            data: ['Derivation error', 'NN loss']
        },
        // toolbox: {
        //     feature: {
        //         saveAsImage: {}
        //     }
        // },
        series: [
        {   
            name: 'NN loss',
            data: graph2_data[rank],
            type: 'line'
        },
        {
            name: 'Derivation error',
            data: graph3_data[rank],
            type: 'line'
        }
        ]
    };

    myChart_l.setOption(option);
}
        

let write_r = function(b_id) {
    let rank = parseInt(b_id.slice(-1));
    // let result = "$f=u_t+%.5fu_x+%.5fu_y+%.5fu_z-%.5fu_{xx}-%.5fu_{yy}-%.5fu_{zz}$" % tuple(results[rank + 1])
    let lam = [];
    for(let i=0; i<=5; i++){
        lam.push(results[rank][i].toFixed(4));
    }
    let template = "R: " + `f=u_t + ${lam[0]}u_x + ${lam[1]}u_y + ${lam[2]}u_z - ${lam[3]}u_xx - ${lam[4]}u_yy - ${lam[5]}u_zz`;
    // let template = Std：$f=u_t+u_x+2u_y+u_z-u_{xx}-u_{yy}-u_{zz}$;
    // var math = '\\frac{1}{\\sqrt{x^2 + 1}}';
    var el = document.getElementById("exp");
    el.textContent = template;
    // MathJax.Hub.Queue(["Typeset", MathJax.Hub, el]);
    // $("#exp").latex();
    
}



let rb1 = $("#s1"), rb2 = $("#s2"), rb3 = $("#s3"), rb4 = $("#s4"), rb5 = $("#s5"), rb6 = $("#s6"), rb7 = $("#s7"), rb8 = $("#s8"), rb9 = $("#s9"), rb10 = $("#s10");

$("#s1, #s2, #s3, #s4, #s5, #s6, #s7, #s8, #s9, #s10").click(function(){
    console.log('clicked', this.id);
    $("#s1, #s2, #s3, #s4, #s5, #s6, #s7, #s8, #s9, #s10").removeClass('active');
    $(this).addClass('active');
    
    draw_s(this.id);
    draw_l(this.id);
    write_r(this.id);
});

        
